<!DOCTYPE html>
<html>
<head>
    <title>API Configuration Check</title>
</head>
<body>
    <h1>API Configuration Check</h1>
    <div id="config-info"></div>
    <div style="margin-top: 20px;">
        <button onclick="testApiCall()">Test Real API Call</button>
    </div>
    <div id="test-results" style="margin-top: 20px;"></div>

    <script>
        // 显示当前页面可以看到的配置
        function showConfig() {
            const configDiv = document.getElementById('config-info');
            
            // 在浏览器中，我们无法直接访问 process.env
            // 这些值应该通过 webpack DefinePlugin 注入
            configDiv.innerHTML = `
                <h3>Configuration Status:</h3>
                <p><strong>Note:</strong> In the browser, environment variables are injected at build time by webpack.</p>
                <p>To test the real configuration, we need to check from the running application.</p>
                <div style="background: #f5f5f5; padding: 10px; margin: 10px 0;">
                    <h4>Expected API URL:</h4>
                    <p>Staging: https://admin.shafayouxi.org/admin/</p>
                    <p>Production: https://admin.laiwan.io/admin/</p>
                </div>
            `;
        }

        async function testApiCall() {
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML = '<p>Testing API endpoints...</p>';

            const baseUrls = [
                'https://admin.shafayouxi.org/admin/',
                'https://admin.laiwan.io/admin/'
            ];

            const results = [];

            for (const baseUrl of baseUrls) {
                const endpoints = [
                    { name: 'Avatar Stats', path: '/avatar/stats' },
                    { name: 'Avatar List', path: '/avatar/list' },
                ];

                for (const endpoint of endpoints) {
                    const fullUrl = `${baseUrl}${endpoint.path}`;
                    
                    try {
                        const response = await fetch(fullUrl, {
                            method: 'GET',
                            headers: {
                                'Content-Type': 'application/json',
                                // 注意：可能需要认证头
                            },
                        });

                        results.push({
                            baseUrl,
                            endpoint: endpoint.name,
                            url: fullUrl,
                            status: response.status,
                            statusText: response.statusText,
                            success: response.ok,
                            headers: [...response.headers.entries()]
                        });

                        if (response.ok) {
                            try {
                                const data = await response.json();
                                results[results.length - 1].data = data;
                            } catch (e) {
                                results[results.length - 1].parseError = 'Could not parse JSON';
                            }
                        }
                    } catch (error) {
                        results.push({
                            baseUrl,
                            endpoint: endpoint.name,
                            url: fullUrl,
                            error: error.message,
                            success: false
                        });
                    }
                }
            }

            displayResults(results);
        }

        function displayResults(results) {
            const resultsDiv = document.getElementById('test-results');
            let html = '<h3>Test Results:</h3>';

            results.forEach(result => {
                const status = result.success ? '✅' : '❌';
                html += `
                    <div style="margin-bottom: 15px; padding: 10px; border: 1px solid #ccc; border-radius: 5px;">
                        <h4>${status} ${result.endpoint}</h4>
                        <p><strong>Base URL:</strong> ${result.baseUrl}</p>
                        <p><strong>Full URL:</strong> ${result.url}</p>
                        ${result.status ? `<p><strong>Status:</strong> ${result.status} ${result.statusText}</p>` : ''}
                        ${result.error ? `<p style="color: red;"><strong>Error:</strong> ${result.error}</p>` : ''}
                        ${result.data ? `
                            <details>
                                <summary>Response Data</summary>
                                <pre>${JSON.stringify(result.data, null, 2)}</pre>
                            </details>
                        ` : ''}
                        ${result.headers ? `
                            <details>
                                <summary>Response Headers</summary>
                                <pre>${result.headers.map(([key, value]) => `${key}: ${value}`).join('\n')}</pre>
                            </details>
                        ` : ''}
                    </div>
                `;
            });

            resultsDiv.innerHTML = html;
        }

        // 页面加载时显示配置
        window.onload = showConfig;
    </script>
</body>
</html>